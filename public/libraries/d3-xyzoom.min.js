!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,o,i,r){"use strict";function u(t){return function(){return t}}function h(t,e,n){this.target=t,this.type=e,this.transform=n}function s(t,e,n,o){this.kx=n,this.ky=o||n,this.x=t,this.y=e}function c(t){return t.__zoom||y}function a(){i.event.stopImmediatePropagation()}function f(){i.event.preventDefault(),i.event.stopImmediatePropagation()}function l(){return!i.event.button}function m(){var t,e,n=this;if(n instanceof SVGElement)n=n.ownerSVGElement||n,t=n.width.baseVal.value,e=n.height.baseVal.value;else{if(!(n&&n.clientWidth&&n.clientHeight))throw"d3-xyzoom failed to constrain scales because extent is undefined.";t=n.clientWidth,e=n.clientHeight}return[[0,0],[t,e]]}function p(){return this.__zoom||y}function d(){function t(t){t.on("wheel.zoom",_).on("mousedown.zoom",g).on("dblclick.zoom",w).on("touchstart.zoom",M).on("touchmove.zoom",b).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",p)}function c(t,e,n){return e=Math.max(I,Math.min(A,e)),n=Math.max(P,Math.min(B,n)),e===t.kx&&n===t.ky?t:new s(t.x,t.y,e,n)}function d(t,e,n){var o=e[0]-n[0]*t.kx,i=e[1]-n[1]*t.ky;return o===t.x&&i===t.y?t:new s(o,i,t.kx,t.ky)}function y(t,e){var n=t.invertX(e[0][0])-H,o=t.invertX(e[1][0])-K,i=t.invertY(e[0][1])-W,r=t.invertY(e[1][1])-N;return t.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r))}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function x(t,e){t.on("start.zoom",function(){z(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){z(this,arguments).end()}).tween("zoom",function(){var t=this,n=arguments,o=z(t,n),i=t.__zoom,r="function"==typeof e?e.apply(t,n):e,u=R(i.x,r.x),h=R(i.y,r.y),c=R(i.kx,r.kx),a=R(i.ky,r.ky);return function(t){t=1===t?r:new s(u(t),h(t),c(t),a(t)),o.zoom(null,t)}})}function z(t,e){for(var n,o=0,i=C.length;o<i;++o)if((n=C[o]).that===t)return n;return new k(t,e)}function k(t,e){this.that=t,this.args=e,this.index=-1,this.active=0,this.extent=V.apply(t,e)}function _(){function t(){e.wheel=null,e.end()}if(X.apply(this,arguments)){var e=z(this,arguments),n=this.__zoom,o=Math.max(I,Math.min(A,n.kx*(1+D*(-1+Math.pow(2,-i.event.deltaY*(i.event.deltaMode?120:1)/500))))),u=Math.max(P,Math.min(B,n.ky*(1+G*(-1+Math.pow(2,-i.event.deltaY*(i.event.deltaMode?120:1)/500))))),h=i.mouse(this);if(n.kx===I&&(o=u>=I?o:I),n.kx===A&&(o=u<=A?o:A),n.ky===P&&(u=o>=P?u:P),n.ky===B&&(u=o<=B?u:B),e.wheel)e.mouse[0][0]===h[0]&&e.mouse[0][1]===h[1]||(e.mouse[1]=n.invert(e.mouse[0]=h)),clearTimeout(e.wheel);else{if(n.kx===u&&n.ky===o)return;e.mouse=[h,n.invert(h)],r.interrupt(this),e.start()}f(),e.wheel=setTimeout(t,L),e.zoom("mouse",y(d(c(n,o,u),e.mouse[0],e.mouse[1]),e.extent))}}function g(){function t(){f(),o.moved=!0,o.zoom("mouse",y(d(o.that.__zoom,o.mouse[0]=i.mouse(o.that),o.mouse[1]),o.extent))}function e(){u.on("mousemove.zoom mouseup.zoom",null),n.dragEnable(i.event.view,o.moved),f(),o.end()}if(!E&&X.apply(this,arguments)){var o=z(this,arguments),u=i.select(i.event.view).on("mousemove.zoom",t,!0).on("mouseup.zoom",e,!0),h=i.mouse(this);n.dragDisable(i.event.view),a(),o.mouse=[h,this.__zoom.invert(h)],r.interrupt(this),o.start()}}function w(){if(X.apply(this,arguments)){var e=this.__zoom,n=i.mouse(this),o=e.invert(n),r=e.kx*(1+D*(-1+(i.event.shiftKey?.5:2))),u=e.ky*(1+G*(-1+(i.event.shiftKey?.5:2))),h=y(d(c(e,r,u),n,o),V.apply(this,arguments));f(),O>0?i.select(this).transition().duration(O).call(x,h,n):i.select(this).call(t.transform,h)}}function M(){if(X.apply(this,arguments)){var t,e,n,o=z(this,arguments),u=i.event.changedTouches,h=u.length;for(a(),t=0;t<h;++t)e=u[t],n=i.touch(this,u,e.identifier),n=[n,this.__zoom.invert(n),e.identifier],o.touch0?o.touch1||(o.touch1=n):o.touch0=n;return q&&(q=clearTimeout(q),!o.touch1)?(o.end(),n=i.select(this).on("dblclick.zoom"),void(n&&n.apply(this,arguments))):void(i.event.touches.length===h&&(q=setTimeout(function(){q=null},J),r.interrupt(this),o.start()))}}function b(){var t,e,n,o,r=z(this,arguments),u=i.event.changedTouches,h=u.length;for(f(),q&&(q=clearTimeout(q)),t=0;t<h;++t)e=u[t],n=i.touch(this,u,e.identifier),r.touch0&&r.touch0[2]===e.identifier?r.touch0[0]=n:r.touch1&&r.touch1[2]===e.identifier&&(r.touch1[0]=n);if(e=r.that.__zoom,r.touch1){var s=r.touch0[0],a=r.touch0[1],l=r.touch1[0],m=r.touch1[1],p=(p=l[0]-s[0])*p+(p=l[1]-s[1])*p,v=(v=m[0]-a[0])*v+(v=m[1]-a[1])*v;e=c(e,Math.sqrt(p/v),Math.sqrt(p/v)),n=[(s[0]+l[0])/2,(s[1]+l[1])/2],o=[(a[0]+m[0])/2,(a[1]+m[1])/2]}else{if(!r.touch0)return;n=r.touch0[0],o=r.touch0[1]}r.zoom("touch",y(d(e,n,o),r.extent))}function T(){var t,e,n=z(this,arguments),o=i.event.changedTouches,r=o.length;for(a(),E&&clearTimeout(E),E=setTimeout(function(){E=null},J),t=0;t<r;++t)e=o[t],n.touch0&&n.touch0[2]===e.identifier?delete n.touch0:n.touch1&&n.touch1[2]===e.identifier&&delete n.touch1;n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0||n.end()}function Y(){I=K!==H?Math.max(S,(V()[1][0]-V()[0][0])/(K-H)):1/0,P=N!==W?Math.max(j,(V()[1][1]-V()[0][1])/(N-W)):1/0}var q,E,X=l,V=m,I=0,P=0,S=0,j=0,A=1/0,B=1/0,D=1,G=1,H=-(1/0),K=1/0,W=-(1/0),N=1/0,O=250,R=o.interpolateNumber,C=[],F=e.dispatch("start","zoom","end"),J=500,L=150;return t.transform=function(t,e){var n=t.selection?t.selection():t;n.property("__zoom",p),t!==n?x(t,e):n.interrupt().each(function(){z(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},t.scaleBy=function(e,n,o){t.scaleTo(e,function(){var t=this.__zoom.kx,e="function"==typeof n?n.apply(this,arguments):n;return t*e},function(){var t=this.__zoom.ky,e="function"==typeof o?o.apply(this,arguments):o;return t*e})},t.scaleTo=function(e,n,o){t.transform(e,function(){var t=V.apply(this,arguments),e=this.__zoom,i=v(t),r=e.invert(i),u="function"==typeof n?n.apply(this,arguments):n,h="function"==typeof o?o.apply(this,arguments):o;return y(d(c(e,u,h),i,r),t)})},t.translateBy=function(e,n,o){t.transform(e,function(){return y(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof o?o.apply(this,arguments):o),V.apply(this,arguments))})},k.prototype={start:function(){return 1===++this.active&&(this.index=C.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(C.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(e){i.customEvent(new h(t,e,this.that.__zoom),F.apply,F,[e,this.that,this.args])}},t.filter=function(e){return arguments.length?(X="function"==typeof e?e:u(!!e),t):X},t.extent=function(e){return arguments.length?(V="function"==typeof e?e:u([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),Y(),t):V},t.scaleExtent=function(e){return arguments.length?(Array.isArray(e[0])?(S=+e[0][0],A=+e[0][1],j=+e[1][0],B=+e[1][1]):(S=+e[0],A=+e[1],j=S,B=A),Y(),t):[[S,A],[j,B]]},t.scaleRatio=function(e){return arguments.length?(D=+e[0],G=+e[1],t):[D,G]},t.translateExtent=function(e){return arguments.length?(H=+e[0][0],K=+e[1][0],W=+e[0][1],N=+e[1][1],Y(),t):[[H,W],[K,N]]},t.duration=function(e){return arguments.length?(O=+e,t):O},t.interpolate=function(e){return arguments.length?(R=e,t):R},t.on=function(){var e=F.on.apply(F,arguments);return e===F?t:e},t}s.prototype={constructor:s,scale:function(t,e){return e=void 0===e?t:e,1!==t||e&&1!==e?new s(this.x,this.y,this.kx*t,this.ky*e):this},translate:function(t,e){return 0===t&0===e?this:new s(this.x+this.kx*t,this.y+this.ky*e,this.kx,this.ky)},apply:function(t){return[t[0]*this.kx+this.x,t[1]*this.ky+this.y]},applyX:function(t){return t*this.kx+this.x},applyY:function(t){return t*this.ky+this.y},invert:function(t){return[(t[0]-this.x)/this.kx,(t[1]-this.y)/this.ky]},invertX:function(t){return(t-this.x)/this.kx},invertY:function(t){return(t-this.y)/this.ky},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.kx+","+this.ky+")"}};var y=new s(0,0,1,1);c.prototype=s.prototype,t.xyzoom=d,t.xyzoomTransform=c,t.xyzoomIdentity=y,Object.defineProperty(t,"__esModule",{value:!0})});